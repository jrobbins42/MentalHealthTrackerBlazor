@page "/"
@rendermode InteractiveServer
@using MentalHealthTrackerBlazor.Data
@inject EntryManager EntryManager


<h3>Create Mental Health Tracker Entry</h3>

<form @onsubmit="HandleSubmit" class="p-4 border rounded">
    <div class="form-group mb-3">
        <label for="date" class="form-label">Date:</label>
        <input type="date" id="date" class="form-control" @bind="entry.Date" @bind:format="yyyy-MM-dd" />
    </div>

    <div class="form-group mb-3">
        <label for="mood" class="form-label">Mood (1-5):</label>
        <input type="number" id="mood" class="form-control" @bind="entry.Mood" min="1" max="5" />
    </div>

    <div class="form-group mb-3">
        <label for="notes" class="form-label">Notes:</label>
        <textarea id="notes" class="form-control" @bind="entry.Notes"></textarea>
    </div>
    <div class="form-group mb-3">
        <label for="triggers" class="form-label">Triggers:</label>
        <textarea id="triggers" class="form-control" @bind="entry.Triggers"></textarea>
    </div>

    <button type="submit" class="btn btn-primary">Add Entry</button>
</form>

@if (entries == null)
{
    <p><em>Loading entries...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr><th>Date</th><th>Mood</th><th>Notes</th></tr>
        </thead>
        <tbody>
            @foreach (var entry in entries)
            {
                <tr>
                    <td>@entry.Date.ToShortDateString()</td>
                    <td>@entry.Mood / 5</td>
                    <td>@entry.Notes</td>
                    <td>@entry.Triggers</td>
                </tr>
            }
        </tbody>
    </table>
}

    @code 
    {
    private List<MentalHealthEntry> entries = new List<MentalHealthEntry>();
        private MentalHealthEntry entry = new MentalHealthEntry
            {
                UserId = 1,
                Date = DateTime.Today,
                Mood = 3,
                Notes = string.Empty,
                Triggers = string.Empty

            };
        protected override void OnInitialized()
        {
            // This runs when the component loads
            entries = EntryManager.GetEntries();
        }
    
    private async Task HandleSubmit()
        {
            EntryManager.AddMentalHealthEntry(entry);
            entries = EntryManager.GetEntries();
                
            await InvokeAsync(StateHasChanged);
        }
    }